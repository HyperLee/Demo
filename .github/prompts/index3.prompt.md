# index3 - 日曆頁面 開發規格書

本規格定義 Razor Pages 頁面「index3」的月曆功能與 UI/UX、路由、參數驗證、狀態處理、相容性、可存取性、測試與驗收標準，作為前後端協作與實作依據。

## 檔案位置
- 前端: `Pages/index3.cshtml`（頁面標記、版面、互動元件、Bootstrap 樣式整合）
- 後端: `Pages/index3.cshtml.cs`（PageModel：參數接收、日期計算、模型輸出、錯誤處理）

## 目標與摘要
- 呈現一個「月曆視圖」，顯示指定年月的所有日期，並支援年份/月份/日期的快速切換。
- 預設載入：以系統當前日期為基準，顯示「當前月份」的月曆（週標題 + 日期格）。
- 強調「今天」：當前日期以明顯樣式標示（色彩、底色或外框）。
- 點擊任一天：導向該日期的「詳細頁面」（獨立路由，後續可擴充）。
- UI 以 Bootstrap 5 為主，視覺乾淨、具有互動回饋與過場，並保有行動端良好體驗。

## 路由與 URL 規格
- 頁面路由：/index3
- 支援查詢參數（QueryString）：
  - year: 整數，四位數年份，範例 2025
  - month: 整數，1-12
  - day: 整數，1-31（可選，僅用於聚焦與「前往詳細頁」連結建構）
- 範例：/index3?year=2025&month=8、/index3?year=2025&month=8&day=26
- 參數缺省時之預設：
  - year/month 未提供：使用系統今日的年與月
  - day 未提供：不強制聚焦某日，但「今天」若在同月則以樣式強調
- 無效參數處理：
  - 非數字或超界（如 month=13、day=0、day>該月天數）：回退到最接近的有效組合，並在頁面以非侵入式提示（靜態警示區塊或 toast）說明已自動更正。

## 互動流程（重點）
1) 初始載入：讀取 QueryString，決定展示年月；計算該月日曆格（含前補/後補天數以補滿週）。
2) 切換年月：
   - 上/下一個月按鈕
   - 年、月下拉選單（或合併為一個年月選單）
   - 立即提交（GET）並以新 QueryString 重新導向
3) 選擇日期：
   - 點按某個日期格：導向「詳細頁面」路由（見「詳細頁規格」），或暫定導向 /index3?year=YYYY&month=MM&day=DD 供後續行為使用
4) 今日強調：若今日在展示的月份，將今日的日期格以強烈樣式凸顯
5) 響應式：在手機上以單欄或緊湊格線呈現，保有可點擊面積與可讀性

## 功能需求明細（可驗收項）
- 月曆格列：
  - 以「星期日」為一週起始（TW 習慣）。
  - 週標題列：日、一、二、三、四、五、六。
  - 顯示當月所有日期；不足週數以前後月日期補齊，補齊的日期以「次要/淡化」樣式呈現，並不可導向詳細（避免誤觸）。
- 切換控制：
  - 上月 / 下月 按鈕（具按鈕態與 hover 效果）。
  - 年 / 月 選擇器（下拉選單或年月 picker；最低需求為兩個下拉）。
  - 提交方式採 GET，更新 QueryString 後重新整理頁面。
- 今日標示：
  - 當天在當前展示月時：以醒目底色、外框或徽章標出，例如「badge-primary + ring」效果。
- 日期點擊：
  - 點擊當月日期格：導向「詳細頁面」（下節定義）。
  - 點擊非本月補格：無導向（cursor: default）。

## 詳細頁導向規格（占位）
- 目標路由（先行規劃，後續實作）：/Calendar/Detail?date=YYYY-MM-DD
- 導向邏輯：點擊日期格後以完整日期字串組合 QueryString 進行導向。
- 若暫無詳細頁：可先導向同頁 /index3?year=YYYY&month=MM&day=DD，並在介面以醒目區塊顯示選取日期，待未來串接正式詳細頁。

## UI/UX 規格
- 視覺語彙：
  - 使用 Bootstrap 5 現有樣式（專案已含 Bootstrap 函式庫，若採 CDN 也可；實作時避免重複引入）。
  - 主色系以專案 Layout 為準；強調態（今天/選取）需有明顯對比。
  - 補齊日期（非本月）以 text-muted 或降低不透明度呈現。
- 互動回饋：
  - 日期格 hover 有微妙陰影或底色變化；可點擊者顯示 pointer 游標。
  - 切換月份時提供短暫過場（例如淡入）；若保守可先省略動畫。
- 響應式：
  - ≥992px：7 欄等寬格線，日期格最小高度 96px（可調）。
  - <992px：維持 7 欄但縮小字級與間距；<576px 時日期格最小高度 64px，字級最小 12px。
- 無障礙：
  - 日期格使用 button 或具 role="button" 的可聚焦元素（tabindex=0），可以鍵盤 Enter/Space 觸發。
  - 為日期格提供 aria-label（例如「2025-08-26，星期二」）。
  - 今日格加上 aria-current="date"。

## 前端結構（建議）
- 主要區塊：
  - Header：頁題 + 上/下月按鈕 + 年/月選擇器
  - Weekdays Bar：日到六
  - Grid：6 列 × 7 欄的格線（最多 6 週）
  - 訊息區：參數自動更正/錯誤提示（dismissible alert）
- 樣式命名（舉例）：
  - .calendar, .calendar-header, .calendar-weekdays, .calendar-grid, .calendar-cell
  - .calendar-cell--today, .calendar-cell--muted, .calendar-cell--selected

## 後端 PageModel 規格（`Pages/index3.cshtml.cs`）
- Input 參數：
  - [FromQuery] int? Year
  - [FromQuery] int? Month
  - [FromQuery] int? Day
- 輸出模型：
  - DisplayYear, DisplayMonth（實際用於呈現的年月）
  - Today（DateOnly）
  - SelectedDate（DateOnly?，從 Day 參數組合而來；僅用於聚焦/導向）
  - CalendarCells（IEnumerable<CalendarCellView>），依序 42 格（6 週 × 7 天）：
    - Date（DateOnly）
    - InCurrentMonth（bool）
    - IsToday（bool）
    - IsSelected（bool）
    - DayOfWeek（int，0=Sun..6=Sat）
- 邏輯：
  - 計算該月第一天、當月天數、第一格需回推幾天（以 Sunday 為週起始）。
  - 產出 42 格日期，標記事件屬性。
  - 驗證與回退：若輸入無效（如 2025/2/30），回退至最接近有效日期（同月最後一天），並記錄訊息供頁面顯示。

## 驗證與錯誤處理
- 年/月/日驗證：
  - Year：範圍 1900–2100；超界自動裁切至邊界。
  - Month：1–12；超界回退到合法值（<1→1，>12→12）。
  - Day：1–該月最大天；超界回退至該月最後一天。
- 錯誤顯示：
  - 以 Bootstrap alert（info/warning）顯示「已自動更正為 YYYY/MM/DD」。
  - 不中斷頁面載入；不丟出例外至使用者。

## 相容性與效能
- 瀏覽器：Chrome/Edge/Safari/Firefox 最新兩個主要版本。
- 效能：
  - 計算月曆為 O(1) 時間與 O(1) 記憶體（固定 42 格）；目標首次渲染 < 50ms（視環境）。
  - 不引入額外大型相依套件；重用既有 Bootstrap 與 Layout。

## i18n 與在地化
- 週標題與日期格式：預設中文（台灣）樣式；未來可依專案 i18n 機制（wwwroot/js/i18n-*.js）切換語系。
- 日期字串格式：YYYY-MM-DD（ISO 8601），避免歧義。

## 可測性與測試規格
- 單元測試（日期計算核心）：
  - Happy path：2025/8 月產出正確 42 格，1 號對應正確星期，當月天數正確。
  - 邊界：
    - 月跨年（2024/12 → 2025/1 切換）。
    - 閏年二月（2024/2、2025/2）。
    - 無效日（2025/2/30）回退到 2025/2/29（閏年）或 2025/2/28（平年）。
- UI 測試（手動/自動）：
  - 響應式：手機與桌面呈現正確且可點擊。
  - 可存取性：鍵盤可逐格移動與啟動；aria 標示存在。
  - 導向：點擊當月日期會導向含完整日期的 URL。

## 驗收標準（Acceptance Criteria）
- 預設載入顯示當前月份月曆，週標題正確，格數齊全。
- 今日日期在當月時有顯著樣式標示。
- 可透過上/下一個月按鈕與年/月選擇器切換月份，URL 參數同步更新。
- 點擊當月日期可成功導向包含 YYYY-MM-DD 的 URL（詳細頁或暫代同頁）。
- 非法參數會被自動更正並以 alert 顯示提示訊息。
- 版面在手機/桌面皆清晰可讀、可點擊，互動有回饋，無明顯排版錯亂。
- 基本可存取性與鍵盤操作可用。

## 非功能性需求補充
- 穩定性：單純使用 .NET 8 內建日期 API，不引入額外日期函式庫。
- 維護性：日期計算封裝為獨立小型函式，便於單元測試與重用。
- 記錄：必要時以最小化記錄（Debug）輸出參數校正資訊（非生產環境）。

## 風險與對策
- 時區差異導致「今日」判定偏差：統一使用伺服器時區，並在顯示上以當地化格式呈現。
- 未來語系擴充：週標題與月份名稱抽離為可替換資源。

## 實作提示（不含程式碼）
- 建議在 PageModel 中輸出 42 格的視圖模型，View 以 foreach 生成；以 InCurrentMonth/IsToday 控制樣式。
- 將「上/下一月」按鈕的連結以取得的 DisplayYear/DisplayMonth 推算產生，避免手寫邏輯錯誤。
- 保持樣式類別命名一致，減少日後樣式調整的影響面。
